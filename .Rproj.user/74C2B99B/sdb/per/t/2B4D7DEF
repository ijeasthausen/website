{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Exploration and visualization of Alzheimer's Disease clinical trials summary made easy with ACT (Alzheimer's Clinical Trials) Shiny Dashboard\" \nauthor: \"Feben Asefaha, Imaani Easthausen, Faith Parsons, Volha Tryputsen\"\ndate: \"December 4, 2017\"\noutput: \n  html_document:\n    self_contained: no\n    theme: cosmo\n    highlight: haddock\n    toc: true\n    toc_float:\n      collapse: true\n      smooth_scroll: false\n---\n\n```{r setOptions}\nlibrary(googleVis)\nop <- options(gvis.plot.tag='chart')\n\n```\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)\nknitr::opts_chunk$set(fig.width = 6, fig.asp = .6, out.width = \"90%\")\noptions(knitr.table.format = \"html\") \n```\n\n```{r libraries, echo=FALSE}\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(janitor)\nlibrary(plotly)\nlibrary(stringr)\nlibrary(plotly)\n\nlibrary(readr)\nlibrary(timevis)\nlibrary(XML)\nlibrary(ggmap)\nlibrary(leaflet)\nlibrary(splitstackshape)\nlibrary(purrr)\nlibrary(DT)\n\nsuppressPackageStartupMessages(library(googleVis)) \n\n```\n\n```{r options, warning = FALSE}\nop <- options(gvis.plot.tag='chart')\nsource(\"functions.R\")\n```\n\n\n# Introduction \nAlzheimers Disease (AD) is a progressive disease that destroys memory and other important mental functions. It is the [6th leading cause of death in the US](https://www.alz.org/facts/), and it [does not have a cure](https://www.alz.org/alzheimers_disease_treatments.asp). The latter fact strongly affects a family of a newly diagnosed with AD patient. Exploring the landscape of ongoing clinical trials, targeting AD, is the next step family takes to assess possible treatment options. [Clinicaltrials.gov](https://clinicaltrials.gov) is a database of clinical studies conducted around the world and is a great place to start exploring experimental treatment possibilities. It has user friendly interface and provides extensive amount of clinical trials information. However, it could be overwhelming for someone without special training to dive through tabulated extensive information available at [clinicaltrials.gov](https://clinicaltrials.gov). \nA web-based visualization tool, which summaries Alzheimer`s Disease clinal trial information while sourcing data from [clinicaltrials.gov](https://clinicaltrials.gov), could be a useful tool for those families, impacted by the illness and seeking a quick visual reference guide on Alzheimers Disease clinical trials past and present research.  \n\n\n# Data and methods   \nThe data were obtained by downloading all results associated with a search for \"alzheimer\" on the website clinicaltrials.gov. Data were accessed on 11/09/2017. All studies associated with the search term were included regardless of whether the study had previously completed, terminated, or other enrollment status factors. The data used in analyses are available in the `data` file on the github page and the primary datafile used in analysis is called `SearchResultsTable.csv`. \n\nAdditional variables of interest were obtained by downloading all the data from each webpage associated with all studys returned in the original \"alzheimer\" search. These data were also accessed on 11/09/2017. Source code for how the \n\n\n## File names [Imaani]  \nThe data were obtained by downloading all results associated with a search for \"alzheimer\" on the website clinicaltrials.gov. Data were accessed on 11/09/2017. All studies associated with the search term were included regardless of whether the study had previously completed, terminated, or other enrollment status factors. The data used in analyses are available in the `Data` file on the github page and the primary datafile used in analysis is called `SearchResultsTable.csv`. \n\nAdditional variables of interest were obtained by downloading all the data from each webpage associated with all studys returned in the original \"alzheimer\" search. These data were also accessed on 11/09/2017. Source code for extracting these variables are available in the file `Extracting_data_across_all_xml_files.Rmd` also on the github page. An additional dataset called `alzheimers_data` containing all variables associated with each study identified during the \"alzheimer\" search. \n\nThe datasets `SearchResultsTable.csv` and `alzheimers_data` contain largely overlapping variables. The dataset `SearchResultsTable.csv` is generally more processed, particularly for natural language variables. However, `alzheimers_data` contains several variables not available in `SearchResultsTable.csv` that an interested future researcher may access. \n\n\n## Summary statistics [Faith/Volha?]  \n\n```{r load_data}\ndata = \n  read_csv(\"Data/SearchResultsTable.csv\") %>%\n  clean_names() \n\n# Create dataset for descriptives for clinical trials in the US\nus_studies = data %>%\n  # Filter only studies that have sites in the United States\n  filter(str_detect(locations, \"United States\"))  %>%\n         # Count number of locations, interventions, and funders\n  mutate(num_locs = as.numeric(str_count(locations, \"\\\\|\")) + 1,\n         num_intervs = as.numeric(str_count(interventions, \"\\\\|\")) + 1,\n         num_funders = as.numeric(str_count(funded_bys, \"\\\\|\")) + 1,\n         # Dummy for Funded by - \"Industry\"\n         fundby_industry = ifelse(str_detect(funded_bys, \"Industry\") == TRUE, 1, 0),\n         # dummy for Funded by - \"NIH\"\n         fundby_nih = ifelse(str_detect(funded_bys, \"NIH\") == TRUE, 1, 0),\n         # dummy for FUnded by - \"U.S. Fed\"\n         fundby_usfed = ifelse(str_detect(funded_bys, \"U.S. Fed\") == TRUE, 1, 0),\n         # dummy for Funded by - \"Other\")\n         fundby_other = ifelse(str_detect(funded_bys, \"Other\") == TRUE, 1, 0),\n         # Intervention Types -- Dummy Variables\n         interv_drug =  ifelse(str_detect(interventions, \"Drug:\") == TRUE, 1, 0), \n         interv_behav = ifelse(str_detect(interventions, \"Behavioral:\") == TRUE, 1, 0),\n         interv_biol  = ifelse(str_detect(interventions, \"Biological:\") == TRUE, 1, 0), \n         interv_diag  = ifelse(str_detect(interventions, \"Diagnostic Test:\") == TRUE, 1, 0) ,\n         interv_device = ifelse(str_detect(interventions, \"Device:\") == TRUE, 1, 0),\n         interv_rad   = ifelse(str_detect(interventions, \"Radiation:\") == TRUE, 1, 0),\n         interv_diet  = ifelse(str_detect(interventions, \"Dietary Supplement:\") == TRUE, 1, 0),\n         interv_gene  = ifelse(str_detect(interventions, \"Genetic:\") == TRUE, 1, 0),\n         interv_proc  = ifelse(str_detect(interventions, \"Procedure:\") == TRUE, 1, 0),\n         interv_other = ifelse(str_detect(interventions, \"Other:\") == TRUE, 1, 0))\n\n# This data contains the variable on number of US Sites \nnum_ussites = readRDS(\"Data/num_ussites.rds\")\n\n```\n\nThe main datasetcontained  **`r format(nrow(data), nsmall = 1, big.mark = \",\")` records** corresponding to all studies on Alzheimer's Disease registered at the [ClinicalTrials.gov website](http://clinicaltrials.gov) with study start dates from `r data %>% pull(start_date) %>% min()` to `r data %>% pull(start_date) %>% max()`. We restricted our analysis dataset to the **`r nrow(us_studies)`** studies with study sites in the United States. The earliest study on record began on `r us_studies %>% pull(start_date)%>% min()`.\n\nThe number of study sites within the United States ranged from `r min(num_ussites$num_ussites)` to `r max(num_ussites$num_ussites)`. \n\n\n## Exploratory analysis [Volha will combine three figures and an intercative data table]   \n\n[Gantt chart](https://en.wikipedia.org/wiki/Gantt_chart) was created for those studies with available starting and ending dates to visualize the landscape of Alzheimers Disease clinical trials over time.  \n\n```{r data_preprocessing_figure1}\ngantt_data = \n  data %>%\n  mutate( \n    mm_start   = str_sub(start_date,  1,  3), # Extract month\n    yy_start   = str_sub(start_date, -4, -1), # Extract 4-digit year\n    date_start = as.Date(paste(yy_start, mm_start, \"01\", sep = \"-\"), \"%Y-%b-%d\"),\n    mm_end     = str_sub(completion_date,  1,  3),\n    yy_end     = str_sub(completion_date, -4, -1),\n    date_end   = as.Date(paste(yy_end,   mm_end,   \"01\", sep = \"-\"), \"%Y-%b-%d\"),\n    n_locations = str_count(locations , \"\\\\|\"),\n    n_treatments = str_count(interventions, \"\\\\|\"),\n    label = ifelse(acronym == \"null\", title, acronym)\n    ) %>%\n  select(nct_number, title, acronym, date_start, date_end, n_locations, n_treatments,\n           phases, study_type, label, recruitment) %>%\n  # Exclude records with no start or end dates\n  filter(!is.na(date_start) & !is.na(date_end))%>% \n  select(label, everything()) %>%\n  # Declare interactivity filters here\n  filter(study_type == \"Interventional\"  & str_detect(phases, \"Phase 3\") &  recruitment == \"Recruiting\") %>%\n  #Sort by date\n  arrange(date_start)\n```\n\nInteractive lineplot was created for those studies with available age elligibility creteria, where a line represents age elligibility for a particular study against the number of subjects enrolled in a study.   \n```{r data_preprocessing_figure2}\ndata_for_plot = \n  data %>% \n  select(rank, nct_number, phases, study_type, enrollment, nct_number, age, recruitment) %>% \n  mutate(age_start   = str_sub(age,  1,  3) ) %>%\n  mutate(age_start = replace(age_start, age_start == \"Chi\", 0)) %>%\n  mutate(age_start = replace(age_start, age_start == \"up \", 0)) %>%\n  separate(age_start, c(\"age_start\", \"remove\"), \" \") %>%\n  mutate(age_start = as.numeric(age_start)) %>%\n  mutate(n = as.numeric(enrollment)) %>%\n    mutate(age_end = str_sub(age, 13, 14)) %>%\n  # replace \"...Years and older   (Adult, Senior)\" with age_end==100\n  mutate(age_end = replace(age_end, age_end == \" o\", 100)) %>%\n  #replace \"Child, Adult, Senior\" with age_end == 100\n  mutate(age_end = replace(age_end, age_end == \", \", 100)) %>%\n  #replace \"up to 100 Years   (Child, Adult, Senior)\" with age_end==100\n  mutate(age_end = replace(age_end, age_end == \"ar\", 100)) %>%\n  # replace \"...Years and older   (Child, Adult, Senior)\" for those with \n  # starting one digit age with age_end == 100\n  mutate(age_end = replace(age_end, age_end == \"ol\", 100)) %>%\n  # replace \"up to ..Years   (Child, Adult, Senior)\" where ... is 2 digit\n  # with age_end == 100\n  mutate(age_end1 = str_sub(age, 7, 8)) %>%\n  mutate(age_end = replace(age_end, age_end == \"rs\", age_end1[age_end == \"rs\"])) %>%\n  # convert age_end to numeric\n  mutate(age_end = as.numeric(age_end)) %>%\n  select(-c(remove, age_end1)) %>%\n  # reorder \n  mutate(nct_number = forcats::fct_reorder(nct_number, age_start))\n\n\n# Prepare data for line plot - convert into long format and group by nct_number:   \n\n\ndata_for_line_plot = \n  data_for_plot %>%\n  filter(study_type == \"Interventional\"  & str_detect(phases, \"Phase 3\") &  recruitment == \"Recruiting\") %>%\n  gather(key = \"eligible_age\", value = \"years\", age_start, age_end) %>%\n  group_by(nct_number) %>%\n  arrange(years)\n```\n\n\n```{r data_preprocessing_figure3}\nAD_search_results =\n  data %>% \n  dplyr::select(nct_number, recruitment, interventions, gender, age,\n         phases, enrollment, study_type, locations) %>% \n  filter(str_detect(locations, \"United States\")) %>%\n  separate(phases, into = c(\"phase_a\", \"phase_b\", \"phase_c\", \"phase_d\"), sep = \"\\\\|\")  \n\n## separate multiple locations into individual columns\nAD_search_results_split_locations = \n  AD_search_results %>%\n  cSplit(\"locations\", sep = '|')\n\nfor (i in 12:dim(AD_search_results_split_locations)[2]) {\n  AD_search_results_split_locations[[i]] = map(AD_search_results_split_locations[[i]], clean_loc)\n}\n\n\n\n## gathering locations and phases\nAD_edit <- AD_search_results_split_locations %>% \n  gather( key = place, value = location, locations_001:locations_348) %>% \n  select(-place) %>% \n  gather( key = remove, value = phase, phase_a:phase_d) %>% \n  select(-remove)\n\n## simplifying interventions, removing additional country indicator \n## city and state columns\nAD_edit_unique <- AD_edit %>% \n  separate(interventions, into = c(\"interventions\", \"remove\"), sep = ':') %>% \n  select(-remove) %>%\n  mutate(location = sub(\"(.+), United States\", \"\\\\1\", location)) %>% \n  separate(location, into = c(\"city\", \"state\"), sep = \", \") %>% \n  unique() \n  \n\n##Data set from this set is AD_edit_unique\n\nAD_new <- AD_edit_unique %>% \n  mutate(age = sub(\"^([^()]+)$\", \"(\\\\1)\", age)) %>% \n  mutate(cleaned_age = str_extract(age, \"\\\\(.+\\\\)\")) %>%\n  mutate(cleaned_age = sub(\"\\\\((.+)\\\\)\", \"\\\\1\", cleaned_age)) %>% \n   select(-age, -enrollment) \n\nstate_list <- list()\nstate_list[['name']] = c(state.name,\"District of Columbia\")\nstate_list[['abb']] = c(state.abb,\"DC\")\n\nstate_lookup <- setNames(state_list$abb, state_list$name)\n\n##filter out any entry without state because can't map it  \nAD_newer <- AD_new %>% \n  rename(state_name = state) %>%\n  filter(!is.na(state_name)) %>%\n  mutate(state_code = state_lookup[state_name])\n\n\n## merging city and state code\n\nAD_newer$geo_place <- paste(AD_newer$city, \",\", AD_newer$state_code)\n\n## finding all empty cells and replace each one with a string\n\nAD_newer[is.na(AD_newer)] <- \"Not available\"\n\n```\n\n\n\n## Formal analysis [Faith?]  \n\n\n\n# Results [Volha and all]  \nGantt chart (**Figure 1**) and Age Eligibility plot (**Figure 2**) were created for currently recruiting interventional phase 3 trials.   \n\nFigure 1:  Gantt chart  \n\n```{r figure1, results='asis', tidy=FALSE}\ntimeline = \n  gvisTimeline(data = gantt_data,\n               rowlabel = \"nct_number\",\n               barlabel = \"label\",\n               start = \"date_start\",\n               end = \"date_end\",\n               options = list(height = 600, width = 800, \n                             timeline = \"{ singleColor: 'blue' }\"))\nplot(timeline)\n```\n\n\nFigure 2: Interactive plot with lines for eligible age for different clinical trail phases   \n\nAlzheimers Disease is the disease of an older population and clinical trials in the past were targeting older subjects. However, since many hundreds of clinical trials failed in finding a cure, research focuse has shifted to younger population as well with the hope to prevent Alzheimers before the major damage to the brain is done in the later stages of Alzheimers Disease. \n\n```{r}\np = data_for_line_plot %>%\n  na.omit() %>% \n  ggplot(aes(x = years, y = n, color = nct_number, group = nct_number)) +\n  geom_path() +\n  #facet_wrap(~study_type) +\n  labs(x = \"eligible age\",\n       y = \"enrollment\",\n       caption = \"Figure 2\") +\n  theme_bw()\n\nggplotly(p)\n```\n\nFigure 3:  \n```{r figure3}\n\n```\n\n\n```{r interactive_data_table}\nDT::datatable(data, class = 'compact',\n              rownames = FALSE,\n              caption = 'Table 1')\n```\n\n\n```{r}\noptions(op)\n```\n\n\n\nShiny dashboard simplifies Alzheimers Disease landscape research for an inexperienced user and as such provides benefit for a family of a newly diagnosed Alzheimers Disease patient.  \n\n\n\n\n# Discussion  \nThe Shiny dashboard created in this project creates a simple and user-friendly format for interested parties including physician and researchers with less statistical and the data savy patient to explore trends in Alzheimers-related clinical trials. \n\nPossible future directions for this project include updating the Shiny dashboard so that it interacts in real time with the clinicaltrials.gov website. This would allow the data in the dashboard to continue to provide the most up to date information to the user, and would prevent the dashboard from becoming obsolete over time. \n\nOther possible future directions include icorporating additional variables so that the user can gain a more complete picture of the avialable data. Another area of possible expansion might include developing a platform for the user to perform simple statistical tests on the data from within the project website. \n\n\n\n\n\n\n\n",
    "created" : 1512517931451.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3924835616",
    "id" : "2B4D7DEF",
    "lastKnownWriteTime" : 1512516724,
    "last_content_update" : 1512516724,
    "path" : "~/Documents/Biostats MS/Data_Science/final_project/alzheimers_clinical_trials_dashboard_report.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}